<h1>Announcing Acts As Sanitized</h1>
<p>When I was doing my <a href="http://static.al3x.net/securing_rails.pdf">talk on Rails security</a> at RailsConf Europe I joked about delivering a magical plugin, <code>acts_as_impenetrable</code>, that solved all of your security needs.  There&#8217;s still no magic bullet for security, but I&#8217;d like to contribute a smidge of code that brings us a step closer.</p><br /><br />    <p>Rails has the ability to mitigate <a href="http://en.wikipedia.org/wiki/Cross-site_scripting">cross-site scripting attacks</a> in the form of its <a href="http://api.rubyonrails.org/classes/ActionView/Helpers/TextHelper.html#M000516">ActionView::Helpers::TextHelpers#sanitize</a> method.  This method won&#8217;t catch every clever <span class="caps"><span class="caps">XSS</span></span> out there, but it sure helps.  Sadly, <code>sanitize</code> is unavailable by default from your models and controllers; the expected usage pattern is that you&#8217;ll handle sanitization in your view, ex: <code>&amp;lt;%= sanitize(@story.title) %&amp;gt;</code> or <code>&amp;lt;%=h @story.body %&amp;gt;</code>.</p><br /><br />    <p>I don&#8217;t think that&#8217;s especially, uh, agile (or whatever).  Neither is importing those TextHelpers into your controller and reassigning your models&#8217; various attributes to sanitized versions of themselves before saving.  It&#8217;s tedious, it&#8217;s repetitive, and it opens the door to careless errors.  Are you sure that you know <em>every</em> field that gets displayed in your views, even after all those revisions and migrations?</p><br /><br />    <p>My solution to this is a plugin: <a href="http://code.al3x.net/svn/acts_as_sanitized/">acts_as_sanitized</a>.  You use it like so:</p><br /><br /><pre><br />  class Comment &amp;lt; ActiveRecord::Base<br />    acts_as_sanitized<br />  end<br /></pre><br /><br />    <p>That&#8217;s it.  The plugin figures out which fields in your model are able to be sanitized at application runtime.  If you&#8217;re not comfortable with that for some strange reason, you can also specify which fields you&#8217;d like sanitized.  You can even tell it to strip all tags, not just the ones that the <code>sanitize</code> method in Rails handles (<code>script</code> and <code>form</code>).  Plus no more monkeying around in your controllers, no more wasteful filtering in your views.</p><br /><br />    <p>Install like so from the root directory of your Rails app:</p><br /><br /><pre><br />  script/plugin install http://code.al3x.net/svn/acts_as_sanitized/<br /></pre><br /><br />    <p>Documentation is included in the <span class="caps"><span class="caps">README</span></span> file, and there&#8217;s a decent suite of tests included.</p><br /><br />    <p>There isn&#8217;t much to this plugin as it stands, but as <span class="caps"><span class="caps">XSS</span></span> attacks become ever-more complicated, I&#8217;m hoping that this plugin evolves to detect and combat them.  If you see attacks that are sneaking by <code>sanitize</code> and <code>strip_tags</code>, let me know!  Bugs and patches are more than welcome.</p>